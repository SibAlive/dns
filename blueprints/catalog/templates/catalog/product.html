{% extends "header/base.html" %}

{% block content %}
<link type="text/css" href="{{ url_for('catalog.static', filename='css/styles.css') }}" rel="stylesheet" />

<body>
<div class="product-layout">
  {#    breadcrumbds#}
    <nav arial-label="breadcrumb">
        <ol class="breadcrumb">
            {% for item in breadcrumbs %}
                <li class="breadcrumb-item">
                    {% if item.endpoint %}
                        <a href="{{ url_for(item.endpoint, **item.params) }}">{{ item.name }}</a>
                    {% else %}
                        {{ item.name }}
                    {% endif %}
                </li>
            {% endfor %}
        </ol>
    </nav>

  <h1 class="product-h1">{{ product.name }}</h1>

  <div class="product-wrapper">
    <!-- Галерея слева -->
    <aside class="product-gallery">
      <div class="gallery-thumbs">
          {% if product.images %}
              {% for img in product.images %}
                <img src="{{ url_for('catalog.static', filename='images/' ~ img.image_path) }}"
                    class="gallery-thumb {% if img.is_main %}active{% endif %}"
                    data-large="{{ url_for('catalog.static', filename='images/' ~ img.image_path) }}">
              {% endfor %}
          {% else %}
                <img src="{{ url_for('catalog.static', filename='images/placeholder.jpg') }}"
                    class="gallery-thumb active"
                    data-large="{{ url_for('catalog.static', filename='images/placeholder.jpg') }}">
          {% endif %}

      </div>
      <div class="gallery-main">
        {% set main_img = product.images | selectattr('is_main') | first %}
          {% if main_img %}
            <img src="{{ url_for('catalog.static', filename='images/' ~ main_img.image_path) }}"
                 alt="{{ product.name }}"
                 class="gallery-main-img"
                 id="mainProductImg">
          {% else %}
            <img src="{{ url_for('catalog.static', filename='images/placeholder.jpg') }}"
                 alt="Изображение отсутствует"
                 class="gallery-main-img"
                 id="mainProductImg">
          {% endif %}
      </div>
    </aside>

    <!-- Информация и правая колонка -->
    <section class="product-info-section">

      <div class="product-top-block">
        <div class="product-props">
          <div>{{ product.description.replace('\n', '<br>') | safe }}</div>
        </div>
      </div>

      <div class="product-price-row">
        <span class="price-current">{{ product.price | money }} Проверка!!!123₽</span>
        {% if product.latest_price and product.latest_price.price > product.price %}
          <span class="price-old">{{ product.latest_price.price | money}} ₽</span>
        {% endif %}
      </div>

      <div class="product-buy-row">
        <form method="post" action="{{ url_for('catalog.add_to_cart', product_id=product.id) }}">
          <input type="hidden" name="csrf_token" value="{{ g.csrf_token }}">
          <button type="submit" class="buy-btn">Купить</button>
        </form>

        {% set is_favorite = product.id in favorite_ids %}
            <button class="fav-btn favorite-toggle-btn {% if is_favorite %} is-fav {% endif %}"
                data-product-id="{{ product.id }}">
                &#10084;
            </button>
      </div>

      <div class="product-extra-blocks">
        <span class="in-stock">
          {% if product.stock_quantity %}
            В наличии
          {% else %}
            Нет в наличии
          {% endif %}
        </span>
      </div>
    </section>
  </div>
</div>
</body>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.gallery-thumb').forEach(function(thumb) {
    thumb.addEventListener('click', function() {
      // Сменить главное изображение
      const mainImg = document.getElementById('mainProductImg');
      mainImg.src = this.dataset.large;

      // Выделить активную миниатюру
      document.querySelectorAll('.gallery-thumb').forEach(function(img) {
        img.classList.remove('active');
      });
      this.classList.add('active');
    });
  });
});
</script>

{% endblock %}