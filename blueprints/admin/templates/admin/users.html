{% extends 'admin/index.html' %}

{% block info %}
{{ super() }}

<main class="content">
    <h1>Пользователи</h1>
<!--    <div class="users-actions" style="margin-bottom:22px;">-->
<!--      <a href="#"-->
<!--         class="add-user-btn">Добавить пользователя-->
<!--      </a>-->
<!--    </div>-->
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Фамилия</th>
          <th>Имя</th>
          <th>Почта</th>
          <th>Телефон</th>
          <th>Дата регистрации</th>
          <th>Количество заказов</th>
          <th>Статус</th>
          <th>Действия</th>
        </tr>
      </thead>

      <tbody>
        {% if users_with_orders %}
            {% for user, orders in users_with_orders %}
                <tr>
                  <td>{{ user.id }}</td>
                  <td>{{ user.surname }}</td>
                  <td>{{ user.name }}</td>
                  <td>{{ user.email if user.email else '-'}}</td>
                  <td>{{ user.phone if user.phone else '-'}}</td>
                  <td>{{ user.time | datetime('%d.%m.%Y %H:%M:%S') }}</td>
                  <td style="text-align: center;">
                      {% if orders > 0 %}
                        <a href="{{url_for('admin.orders', user_id=user.id) }}"
                        class="order-count-box link">{{ orders }}</a>
                      {% else %}
                      <span class="order-count-box">0</span>
                      {% endif %}
                  </td>
                  <td>{{ 'Активен' if user.is_active else 'Удален'}}</td>
                  <td>
                    {% if user.is_active %}
                        <a href="{{ url_for('admin.user_edit', user_id=user.id) }}"
                           class="user-action-btn">Изменить
                        </a>

                        <form method="POST" action="{{ url_for('admin.user_delete', user_id=user.id) }}" style="display:inline">
                            <input type="hidden" name="csrf_token" value="{{ g.csrf_token }}">
                            <button type="submit" class="entity-action-btn delete" onclick="return confirm('Удалить профиль?')">Удалить профиль</button>
                        </form>
                    {% else %}
                        <a href="{{ url_for('admin.user_restore', user_id=user.id) }}"
                           class="user-action-btn">Восстановить профиль
                        </a>
                    {% endif %}
                  </td>
                </tr>
            {% endfor %}
        {% endif %}
      </tbody>
    </table>
</main>

{% endblock %}