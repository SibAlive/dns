{% extends 'header/base.html' %}

{% block content %}
{{ super() }}

<div class="profile-container">
    <div class="profile-row">

        <!-- Левая колонка: Аватарка и загрузка -->
        <div class="profile-avatar-section">
            <div class="profile-ava">
                <img src="{{ url_for('header.userava') }}" alt="Аватар пользователя">
            </div>
            <div class="profile-load">
                <form action="{{ url_for('header.upload') }}" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ g.csrf_token }}">
                    <label for="file-upload" class="file-upload-button">Выберите файл</label>
                    <span class="file-name">Файл не выбран</span>
                    <input type="file" id="file-upload" name="file" onchange="updateFileName(this)">
                    <input type="submit" value="Загрузить">
                </form>
            </div>
        </div>

        <!-- Правая колонка: Информация или форма редактирования -->
        <div class="profile-info-section">
            {% if not edit_mode %}
                <!-- Режим просмотра -->
                <ul class="profile-info">
                    <li><strong>Фамилия:</strong> {{ current_user.getSurname() }}</li>
                    <li><strong>Имя:</strong> {{ current_user.getName() }}</li>
                    <li><strong>Email:</strong> {{ current_user.getEmail() }}</li>
                    <li><strong>Номер телефона:</strong> {{ current_user.getPhone()
                    if current_user.getPhone() else "не указан"}}</li>
                </ul>
                <form method="post">
                    <input type="hidden" name="csrf_token" value="{{ g.csrf_token }}">
                    <input type="hidden" name="edit_mode" value="True">
                    <button type="submit">Редактировать</button>
                </form>
                <a href="{{ url_for('header.logout') }}" class="profile-logout-link">Выйти из профиля</a>

            {% else %}
                <!-- Режим редактирования -->
                <form method="post" class="profile-edit-form">
                    <input type="hidden" name="csrf_token" value="{{ g.csrf_token }}">

                    {{ form.surname.label }}
                    {{ form.surname(class="form-control", id="surname") }}

                    {{ form.name.label }}
                    {{ form.name(class="form-control", id="name") }}

                    {{ form.email.label }}
                    {{ form.email(class="form-control", id="email") }}

                    {{ form.phone.label }}
                    {{ form.phone(class="form-control", id="phone") }}
                    {% for err in form.phone.errors %}<span class="error">{{ err }}</span>{% endfor %}

                    <div class="profile-actions">
                        <button type="submit">Сохранить</button>
                        <a href="{{ url_for('header.profile') }}">Отмена</a>
                    </div>
                </form>
            {% endif %}
        </div>
    </div>
</div>

<!-- Скрипт для обновления текста "Файл не выбран" -->
<script>
function updateFileName(input) {
    const fileName = input.files[0] ? input.files[0].name : "Файл не выбран";
    document.querySelector('.file-name').textContent = fileName;
}
</script>

{% endblock %}